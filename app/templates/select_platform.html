{% extends "base.html" %}

{% block content %}
<div class="min-h-screen bg-gray-50 dark:bg-gray-900 py-12 animate-fade transition-colors">
    <div class="max-w-4xl mx-auto px-4">
        <!-- Age Verification Section -->
<div id="ageVerificationSection" class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md mb-8 transition-colors">
    <h2 class="text-2xl font-bold mb-4 text-gray-900 dark:text-white transition-colors">Please Enter Your Birth Date to Continue:</h2>
    <form id="ageForm" class="grid grid-cols-3 gap-4">
        <div>
            <label for="day" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white transition-colors">Day</label>
            <select id="day" class="w-full p-2.5 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-700 text-gray-900 dark:text-white transition-colors">
                <option value="">Day</option>
                {% for i in range(1, 32) %}
                    <option value="{{ i }}">{{ i }}</option>
                {% endfor %}
            </select>
        </div>
        <div>
            <label for="month" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white transition-colors">Month</label>
            <select id="month" class="w-full p-2.5 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-700 text-gray-900 dark:text-white transition-colors">
                <option value="">Month</option>
                {% for i in range(1, 13) %}
                    <option value="{{ i }}">{{ i }}</option>
                {% endfor %}
            </select>
        </div>
        <div>
            <label for="year" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white transition-colors">Year</label>
            <select id="year" class="w-full p-2.5 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-700 text-gray-900 dark:text-white transition-colors">
                <option value="">Year</option>
                {% for i in range(2025, 1900, -1) %}
                    <option value="{{ i }}">{{ i }}</option>
                {% endfor %}
            </select>
        </div>
    </form>
    <button id="verifyAgeBtn" class="mt-4 text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800 transition-colors">
        Enter
    </button>
</div>

        <!-- Platform Selection Section -->
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md mb-8 transition-colors">
            <h2 class="text-2xl font-bold mb-6 text-gray-900 dark:text-white transition-colors">Select Your Platform</h2>

            <ul class="grid w-full gap-6 md:grid-cols-3">
                <li>
                    <input type="checkbox" id="windows-option" value="windows" class="hidden peer">
                    <label for="windows-option" class="inline-flex items-center justify-between w-full p-5 text-gray-500 bg-white border-2 border-gray-200 rounded-lg cursor-pointer dark:hover:text-gray-300 dark:border-gray-700 peer-checked:border-blue-600 dark:peer-checked:border-blue-600 hover:text-gray-600 dark:peer-checked:text-gray-300 peer-checked:text-gray-600 hover:bg-gray-50 dark:text-gray-400 dark:bg-gray-800 dark:hover:bg-gray-700 transition-colors">
                        <div class="flex items-center gap-3">
                            <svg class="self-center w-7 h-7 text-sky-500" fill="currentColor" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M3,12V6.75L9,5.43v6.48L3,12M20,3v8.75L10,11.9V5.21L20,3M3,13l6,.09V19.9L3,18.75V13m17,.25V22L10,20.09v-7Z"/>
                            </svg>
                            <div class="w-full text-lg font-semibold">Windows</div>
                        </div>
                    </label>
                </li>
                <li>
                    <input type="checkbox" id="mac-option" value="mac" class="hidden peer">
                    <label for="mac-option" class="inline-flex items-center justify-between w-full p-5 text-gray-500 bg-white border-2 border-gray-200 rounded-lg cursor-pointer dark:hover:text-gray-300 dark:border-gray-700 peer-checked:border-blue-600 dark:peer-checked:border-blue-600 hover:text-gray-600 dark:peer-checked:text-gray-300 peer-checked:text-gray-600 hover:bg-gray-50 dark:text-gray-400 dark:bg-gray-800 dark:hover:bg-gray-700 transition-colors">
                        <div class="flex items-center gap-3">
                            <svg class="self-center w-7 h-7 text-gray-500" fill="currentColor" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">
                                <path d="M318.7 268.7c.3-53.5 44-79.1 45.9-80.3-25.1-36.6-64.2-41.6-77.9-42.1-33.2-3.4-64.6 19.5-81.4 19.5-17 0-43.3-19-71.2-18.5-36.7.5-70.7 21.4-89.5 54.4-38.2 66.1-9.7 163.5 27.5 217.1 18.3 26.4 39.9 56.1 68.3 55 27.3-1.1 37.6-17.7 70.5-17.7s42.1 17.7 71.2 17.2c29.5-.5 48.2-26.9 66.4-53.4 21-30.5 29.6-60 30-61.6-.6-.3-57.4-22-57.8-87.6zm-54.1-170.6c14.7-17.9 24.6-42.8 21.9-67.5-21.2.8-46.9 14.1-62.2 31.9-13.7 15.9-25.7 41.4-22.5 65.6 23.7 1.8 48.1-12.1 62.8-30z"/>
                            </svg>

                            <div class="w-full text-lg font-semibold">Mac</div>
                        </div>
                    </label>
                </li>
                <li>
                    <input type="checkbox" id="linux-option" value="linux" class="hidden peer">
                    <label for="linux-option" class="inline-flex items-center justify-between w-full p-5 text-gray-500 bg-white border-2 border-gray-200 rounded-lg cursor-pointer dark:hover:text-gray-300 dark:border-gray-700 peer-checked:border-blue-600 dark:peer-checked:border-blue-600 hover:text-gray-600 dark:peer-checked:text-gray-300 peer-checked:text-gray-600 hover:bg-gray-50 dark:text-gray-400 dark:bg-gray-800 dark:hover:bg-gray-700 transition-colors">
                        <div class="flex items-center gap-3">
                            <svg class="self-center w-7 h-7 text-black" fill="currentColor" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 268.27 315">
                                <path d="m30.79 298.05c16.613 1.984 35.279 12.746 50.9 14.646 15.705 1.983 20.565-10.695 20.565-10.695s17.673-3.951 36.253-4.406c18.598-0.521 36.203 3.868 36.203 3.868s3.414 7.819 9.787 11.233c6.373 3.48 20.094 3.951 28.888-5.314 8.811-9.332 32.319-21.087 45.519-28.435 13.284-7.365 10.846-18.597 2.506-22.011-8.34-3.413-15.167-8.794-14.646-19.119 0.454-10.24-7.365-17.067-7.365-17.067s6.844-22.532 0.471-41.197c-6.373-18.58-27.392-48.461-43.551-70.926-16.159-22.532-2.439-48.545-17.151-81.789-14.714-33.294-52.867-31.326-73.432-17.135-20.565 14.192-14.26 49.386-13.268 66.084 0.99199 16.613 0.454 28.501-1.446 32.773-1.9 4.338-15.167 20.094-23.978 33.294-8.794 13.267-15.168 40.659-21.608 51.959-6.306 11.233-1.9 21.473-1.9 21.473s-4.405 1.513-7.886 8.879c-3.414 7.281-10.241 10.761-22.533 13.133-12.208 2.505-12.208 10.375-9.265 19.186 2.959 8.794 0 13.721-3.414 24.954-3.413 11.231 13.671 14.644 30.351 16.612zm172.69-51.237c8.727 3.817 21.271-1.497 25.088-5.314 3.801-3.8 6.491-9.45 6.491-9.45s3.817 1.9 3.43 7.936c-0.404 6.121 2.623 14.848 8.34 17.875 5.717 3.01 14.444 7.213 9.921 11.417-4.608 4.204-30.099 14.461-37.716 22.465-7.55 7.953-17.471 14.461-23.508 12.544-6.103-1.9-11.434-10.24-8.81-22.448 2.707-12.157 4.994-25.492 4.607-33.109-0.403-7.617-1.9-17.874 0-19.388 1.9-1.497 4.927-0.774 4.927-0.774s-1.515 14.447 7.23 18.246zm-56.633-205.78c8.407 0 15.184 8.34 15.184 18.597 0 7.281-3.414 13.587-8.408 16.614-1.261-0.521-2.573-1.11-4.019-1.716 3.027-1.496 5.128-5.313 5.128-9.719 0-5.767-3.547-10.509-8.004-10.509-4.338 0-7.954 4.741-7.954 10.509 0 2.103 0.522 4.204 1.379 5.852-2.623-1.06-4.994-1.967-6.894-2.69-0.992-2.506-1.581-5.331-1.581-8.34 1e-3 -10.257 6.76-18.598 15.169-18.598zm-20.818 32.05c4.137 0.723 15.503 5.65 19.708 7.163 4.204 1.446 8.861 4.136 8.407 6.827-0.521 2.774-2.69 2.774-8.407 6.255-5.65 3.414-17.992 11.031-21.944 11.552-3.935 0.521-6.171-1.699-10.376-4.406-4.204-2.758-12.089-9.198-10.106-12.611 0 0 6.171-4.725 8.862-7.146 2.691-2.506 9.652-8.408 13.856-7.634zm-18.127-29.09c6.625 0 12.023 7.886 12.023 17.605 0 1.766-0.202 3.413-0.521 5.061-1.648 0.521-3.295 1.379-4.877 2.758-0.773 0.656-1.497 1.244-2.152 1.9 1.042-1.967 1.446-4.792 0.975-7.752-0.908-5.246-4.456-9.13-7.937-8.609-3.498 0.589-5.583 5.398-4.742 10.712 0.925 5.381 4.405 9.264 7.953 8.676 0.202-0.067 0.387-0.134 0.589-0.202-1.698 1.648-3.279 3.094-4.927 4.271-4.792-2.237-8.34-8.929-8.34-16.815 1e-3 -9.786 5.314-17.605 11.956-17.605zm-36.909 127.22c6.827-10.761 11.232-34.286 18.059-42.105 6.895-7.802 12.208-24.432 9.787-31.78 0 0 14.713 17.605 24.954 14.713 10.257-2.96 33.311-20.094 36.724-17.151 3.414 2.959 32.773 67.529 35.732 88.094 2.96 20.548-1.967 36.254-1.967 36.254s-11.232-2.96-12.679 3.867c-1.446 6.894-1.446 31.865-1.446 31.865s-15.184 21.019-38.692 24.499c-23.508 3.414-35.279 0.925-35.279 0.925l-13.2-15.117s10.258-1.513 8.811-11.821c-1.446-10.24-31.344-24.433-36.725-37.179-5.379-12.746-0.99-34.286 5.921-45.064zm-58.13 77.114c1.177-5.044 16.411-5.044 22.263-8.592s7.028-13.738 11.754-16.428c4.657-2.758 13.267 7.029 16.815 12.543 3.481 5.381 16.816 28.906 22.264 34.757 5.515 5.902 10.577 13.721 8.996 20.75-1.496 7.028-9.786 12.157-9.786 12.157-7.415 2.287-28.098-6.642-37.497-10.577-9.399-3.951-33.311-5.129-36.388-8.609-3.161-3.548 1.513-11.367 2.757-18.783 1.109-7.499-2.371-12.157-1.178-17.218z"/>
                            </svg>
                            <div class="w-full text-lg font-semibold">Linux</div>
                        </div>
                    </label>
                </li>
        </ul>
        </div>
        
        <!-- Continue Button -->
        <div class="text-center mt-8">
        <button id="continue-btn" onclick="handleContinue()"
                class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed inline-block">
                Continue
        </button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const platformButtons = document.querySelectorAll('.platform-btn');
    const continueBtn = document.getElementById('continue-btn');
    let selectedPlatform = null;
    let platform1,platform2,platform3

    // Age Verification Handling
    document.getElementById('verifyAgeBtn').addEventListener('click', function() {
        const day = document.getElementById('day').value;
        const month = document.getElementById('month').value;
        const year = document.getElementById('year').value;

        if (!day || !month || !year) {
            alert('Please enter your full date of birth.');
            return;
        }

        const today = new Date();
        const birthDate = new Date(year, month - 1, day);

        let age = today.getFullYear() - birthDate.getFullYear();
        const monthDiff = today.getMonth() - birthDate.getMonth();
        const dayDiff = today.getDate() - birthDate.getDate();

        if (monthDiff < 0 || (monthDiff === 0 && dayDiff < 0)) {
            age--;
        }

        window.userAge = age;

        if (age < 13) {
            alert('Sorry, you must be at least 13 years old to continue.');
            return;
        }

        document.getElementById('ageForm').classList.add('hidden');
        document.getElementById('verifyAgeBtn').classList.add('hidden');

        // Create and show the Rated M eligibility message in place of form
        const messageArea = document.createElement('div');
        messageArea.className = "mt-4 text-lg font-medium";

        if (age >= 17) {
            messageArea.classList.add('text-green-600', 'dark:text-green-400');
            messageArea.textContent = "You're 17 or older, Rated M games will be included in your recommendations.";
            window.isAdultUser = true;
        } else {
            messageArea.classList.add('text-yellow-600', 'dark:text-yellow-400');
            messageArea.textContent = "You're under 17,  Rated M games will be excluded from your recommendations.";
            window.isAdultUser = false;
        }

        document.getElementById('ageVerificationSection').appendChild(messageArea);

        // Scroll to platform selection
        document.querySelector('[data-platform]').scrollIntoView({ behavior: 'smooth' });
    });

    // Display recommendations
    function displayResults(recommendations) {
        const resultsDiv = document.getElementById('results');
        resultsDiv.innerHTML = '';

        if (recommendations.length === 0) {
            resultsDiv.innerHTML = '<p class="text-gray-500 dark:text-gray-400">No recommendations found.</p>';
            return;
        }

        recommendations.forEach(game => {
            const gameCard = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-bold mb-2 text-gray-900 dark:text-white">${game.name}</h3>
                    <p class="text-gray-600 dark:text-gray-400 mb-4">${game.description}</p>
                    <div class="flex items-center space-x-4">
                        <p class="text-blue-600 dark:text-blue-400">Price: $${game.price}</p>
                        <div class="flex space-x-2">
                            ${game.platforms ? game.platforms.map(platform => 
                                `<span class="px-2 py-1 text-xs font-semibold rounded-full bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200">${platform}</span>`
                            ).join('') : ''}
                        </div>
                    </div>
                </div>
            `;
            resultsDiv.innerHTML += gameCard;
        });
    }
});
function handleContinue(){
    let adultUserParam
          if (typeof window.isAdultUser === 'undefined') {
            alert('Please choose your age before continuing.');
            return;
        }
        else
        {
            if (window.isAdultUser)
        {
            adultUserParam = 18
        }
        else
        {
            adultUserParam = 0
        }
        }

        var checkboxes = document.querySelectorAll("input[type=checkbox]");

        let checkedValues = [];

        checkboxes.forEach((checkbox) => {
            if (checkbox.checked) {
            checkedValues.push(checkbox.value);
            }
        });
        
                // If none checked, treat as if all are selected
        if (checkedValues.length === 0) {
            checkboxes.forEach(checkbox => checkedValues.push(checkbox.value));
        }
        const finalString = checkedValues.join(';');

        const url = new URL('{{ url_for("main.select_favorites") }}', window.location.origin);
        url.searchParams.set('platform', finalString);
        url.searchParams.set('age', adultUserParam);

        window.location.href = url.toString();

        console.log(adultUserParam)
        console.log(finalString)
    };
</script>
{% endblock %}